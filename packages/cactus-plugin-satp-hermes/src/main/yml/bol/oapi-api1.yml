openapi: 3.0.3
info:
  title: SATP Gateway Client (API-Type 1)
  version: 0.0.2
  description: |-
    SATP is a protocol operating between two gateways that conducts the transfer of a digital asset 
    from one gateway to another. The protocol establishes a secure channel between the endpoints 
    and implements a 2-phase commit to ensure the properties of transfer atomicity, consistency, 
    isolation and durability.

    This API defines the gateway client facing API (API-Type 1 in the SATP-Core specification).

    ## Adapter Layer

    The SATP Hermes plugin includes an Adapter Layer that enables external systems to integrate 
    with and control SATP transfers through webhook-based communication. This enables compliance 
    systems, business logic, and human-in-the-loop workflows to participate in cross-chain asset 
    transfers.

    ### Webhook Types

    | Type | Direction | Purpose |
    |------|-----------|---------|
    | **Outbound Webhooks** | Gateway → External System | Notify external systems about SATP events |
    | **Inbound Webhooks** | External System → Gateway | Allow external systems to approve/reject transfers |

    ### Key Concepts

    - **Execution Points**: Adapters are triggered at specific points in the SATP protocol (stage + step + order)
    - **Adapters**: Configuration units that define which webhooks to call and when
    - **Session Control**: Inbound webhooks can pause transfers pending external approval

    ### Inbound Webhook Approval Flow

    1. Gateway reaches configured execution point with inbound adapter
    2. Gateway pauses SATP execution and waits for external decision
    3. External controller evaluates transfer (compliance, business rules, manual review)
    4. Controller POSTs decision to `/webhook/inbound/decide` endpoint
    5. Gateway validates decision and resumes or aborts transfer

    **Additional Resources**:
    - [Proposed SATP Charter](https://datatracker.ietf.org/doc/charter-ietf-satp/)
    - [SATP Core draft](https://datatracker.ietf.org/doc/draft-ietf-satp-core)
    - [SATP Crash Recovery draft](https://datatracker.ietf.org/doc/draft-belchior-satp-gateway-recovery/)
    - [SATP Architecture draft](https://datatracker.ietf.org/doc/draft-ietf-satp-architecture/)
    - [SATP Use-Cases draft](https://datatracker.ietf.org/doc/draft-ramakrishna-sat-use-cases/)
    - [SATP Data sharing draft](https://datatracker.ietf.org/doc/draft-ramakrishna-satp-data-sharing)
    - [SATP View Addresses draft](https://datatracker.ietf.org/doc/draft-ramakrishna-satp-views-addresses)
  contact:
    name: Hyperledger Cacti
  x-logo:
    altText: Cacti logo
    backgroundColor: '#fafafa'
    url: https://github.com/hyperledger/cacti/blob/main/images/HL_Cacti_Logo_Color.png
externalDocs:
  description: For more information about the SATP Gateway Client, refer to the official documentation.
  url: https://github.com/hyperledger/cacti/tree/main/packages/cactus-plugin-satp-hermes/README.md
servers:
  - url: http://{host}:{port}/api/v1/@hyperledger/cactus-plugin-satp-hermes
    description: Development server
    variables:
      host:
        default: localhost
      port:
        default: '3011'
tags:
  - name: transaction
    description: API endpoints for interacting with blockchains via gateways
  - name: admin
    description: API endpoints for fetching information on SATP sessions
  - name: get-approve-address
    description: API endpoint for getting approve address for token transfer
  - name: add-counterparty
    description: API endpoint for adding a counterparty to the gateway
  - name: oracle
    description: API endpoints for oracle tasks management
  - name: webhook
    description: API endpoints for inbound webhook decisions from external approval controllers
paths:
  /api/v1/@hyperledger/cactus-plugin-satp-hermes/transact:
    post:
      tags:
        - transaction
      x-hyperledger-cacti:
        http:
          verbLowerCase: post
          path: /api/v1/@hyperledger/cactus-plugin-satp-hermes/transact
      summary: Submit a transaction intent
      description: Allows users to queue intents for transactions based on specified parameters.
      operationId: Transact
      requestBody:
        description: Transact request object.
        required: true
        content:
          application/json:
            schema:
              $ref: ./schemas.yml#/TransactRequest
      responses:
        '200':
          description: Transaction successfully queued
          content:
            application/json:
              schema:
                $ref: ./schemas.yml#/TransactResponse
        default:
          description: An error occurred
          content:
            application/json:
              schema:
                $ref: ./schemas.yml#/APIError
  /api/v1/@hyperledger/cactus-plugin-satp-hermes/cancel:
    post:
      tags:
        - transaction
      summary: Cancel a transaction session
      description: Attempts to cancel a previously submitted transaction intent using its session ID.
      operationId: Cancel
      x-hyperledger-cacti:
        http:
          verbLowerCase: post
          path: /api/v1/@hyperledger/cactus-plugin-satp-hermes/cancel
      requestBody:
        description: Cancel request object.
        content:
          application/json:
            schema:
              $ref: ./schemas.yml#/CancelRequest
        required: true
      responses:
        '200':
          description: Transaction cancellation attempted
          content:
            application/json:
              schema:
                $ref: ./schemas.yml#/CancelResponse
        default:
          description: An error occurred or transaction cannot be cancelled
          content:
            application/json:
              schema:
                $ref: ./schemas.yml#/APIError
  /api/v1/@hyperledger/cactus-plugin-satp-hermes/status:
    get:
      summary: Get SATP current session data
      description: Retrieve the status of a SATP session
      operationId: GetStatus
      tags:
        - admin
      x-hyperledger-cacti:
        http:
          verbLowerCase: get
          path: /api/v1/@hyperledger/cactus-plugin-satp-hermes/status
      parameters:
        - name: SessionID
          in: query
          schema:
            $ref: ./schemas.yml#/SessionID
          required: true
          description: Unique identifier for the session.
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                $ref: ./schemas.yml#/StatusResponse
        '400':
          description: Bad request
        '404':
          description: Transaction not found
        '500':
          description: Internal server error
  /api/v1/@hyperledger/cactus-plugin-satp-hermes/get-sessions-ids:
    get:
      summary: Get SATP session ids
      description: Retrieve the all SATP session IDs
      operationId: GetSessionIds
      tags:
        - admin
      x-hyperledger-cacti:
        http:
          verbLowerCase: get
          path: /api/v1/@hyperledger/cactus-plugin-satp-hermes/get-sessions-ids
      parameters:
        - name: SessionsRequest
          description: Request object for fetching session IDs.
          in: query
          schema:
            $ref: ./schemas.yml#/AllSessionIdsRequest
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                $ref: ./schemas.yml#/AllSessionIdsResponse
        '400':
          description: Bad request
        '404':
          description: Transaction not found
        '500':
          description: Internal server error
  /api/v1/@hyperledger/cactus-plugin-satp-hermes/healthcheck:
    get:
      summary: Health check endpoint
      description: Responds if SATP Hermes is on
      operationId: GetHealthCheck
      tags:
        - admin
      x-hyperledger-cacti:
        http:
          verbLowerCase: get
          path: /api/v1/@hyperledger/cactus-plugin-satp-hermes/healthcheck
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                $ref: ./schemas.yml#/HealthCheckResponse
        '500':
          description: Internal server error
  /api/v1/@hyperledger/cactus-plugin-satp-hermes/continue:
    post:
      tags:
        - admin
      summary: Continue a paused transaction session
      description: Attempts to continue a previously paused transaction intent, resuming its execution.
      operationId: Continue
      x-hyperledger-cacti:
        http:
          verbLowerCase: post
          path: /api/v1/@hyperledger/cactus-plugin-satp-hermes/continue
      requestBody:
        description: Continue request object.
        content:
          application/json:
            schema:
              $ref: ./schemas.yml#/ContinueRequest
        required: true
      responses:
        '200':
          description: Transaction continuation attempted
          content:
            application/json:
              schema:
                $ref: ./schemas.yml#/ContinueResponse
        default:
          description: An error occurred or transaction cannot be continued
          content:
            application/json:
              schema:
                $ref: ./schemas.yml#/APIError
  /api/v1/@hyperledger/cactus-plugin-satp-hermes/pause:
    post:
      tags:
        - admin
      summary: Pause a transaction session
      description: Attempts to pause a previously submitted transaction intent, temporarily halting its execution.
      operationId: Pause
      x-hyperledger-cacti:
        http:
          verbLowerCase: post
          path: /api/v1/@hyperledger/cactus-plugin-satp-hermes/pause
      requestBody:
        description: Pause request object.
        content:
          application/json:
            schema:
              $ref: ./schemas.yml#/PauseRequest
        required: true
      responses:
        '200':
          description: Transaction pause attempted
          content:
            application/json:
              schema:
                $ref: ./schemas.yml#/PauseResponse
        default:
          description: An error occurred or transaction cannot be paused
          content:
            application/json:
              schema:
                $ref: ./schemas.yml#/APIError
 
  /api/v1/@hyperledger/cactus-plugin-satp-hermes/integrations:
    get:
      description: Retrieves metadata about each supported blockchain networks, chains, and other systems.
      summary: Get supported integrations
      tags:
        - transaction
      operationId: GetIntegrations
      x-hyperledger-cacti:
        http:
          verbLowerCase: get
          path: /api/v1/@hyperledger/cactus-plugin-satp-hermes/integrations
      responses:
        "200":
          description: A list of supported systems.
          content:
            application/json:
              schema:
                $ref: ./schemas.yml#/IntegrationsResponse
        default:
          description: An error occurred
          content:
            application/json:
              schema:
                $ref: ./schemas.yml#/APIError

  /api/v1/@hyperledger/cactus-plugin-satp-hermes/routes:
    get:
      description: Get a list of possible routes for swapping one asset for another across multiple exchanges
      summary: Get a list of routes for a gateway-to-gateway asset transfer
      tags:
        - transaction
      operationId: GetRoutes
      x-hyperledger-cacti:
        http:
          verbLowerCase: get
          path: /api/v1/@hyperledger/cactus-plugin-satp-hermes/routes
      parameters:
        - name: fromNetworkID
          in: query
          schema:
            $ref: '#/components/schemas/NetworkId'
          required: true
          description: The sending DLT Network.
        - name: fromAmount
          in: query
          schema:
            $ref: ./schemas.yml#/AmountString
          required: true
          description: The amount that should be sent including all decimals.
        - name: fromToken
          in: query
          schema:
            $ref: ./schemas.yml#/Address
          required: true
          description: The token that should be transferred. Can be the address or the symbol.
        - name: toDLTNetwork
          in: query
          schema:
            $ref: '#/components/schemas/NetworkId'
          required: true
          description: The receiving DLT Network.
        - name: toToken
          in: query
          schema:
            $ref: ./schemas.yml#/Address
          required: true
          description: The token that should be transferred to. Can be the address or the symbol.
        - name: fromAddress
          in: query
          schema:
            $ref: ./schemas.yml#/Address
          required: true
          description: The sending wallet address.
        - name: toAddress
          in: query
          schema:
            $ref: ./schemas.yml#/Address
          required: true
          description: The receiving wallet address. If none is provided, the fromAddress will be used.
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                $ref: ./schemas.yml#/RoutesResponse
        default:
          description: An error occurred
          content:
            application/json:
              schema:
                $ref: ./schemas.yml#/APIError
  /api/v1/@hyperledger/cactus-plugin-satp-hermes/audit:
    get:
      tags:
        - admin
      summary: Audit transactions
      description: Audits transactions based on provided filters such as start and end dates. Optionally includes proofs generated from each gateway transaction.
      operationId: PerformAudit
      x-hyperledger-cacti:
        http:
          verbLowerCase: get
          path: /api/v1/@hyperledger/cactus-plugin-satp-hermes/audit
      parameters:
        - name: startTimestamp
          in: query
          description: The start timestamp for the audit period.
          required: false
          schema:
            type: integer
            format: int64
        - name: endTimestamp
          in: query
          description: The end timestamp for the audit period.
          required: false
          schema:
            type: integer
            format: int64
      responses:
        '200':
          description: Audit results
          content:
            application/json:
              schema:
                $ref: ./schemas.yml#/AuditResponse
  /api/v1/@hyperledger/cactus-plugin-satp-hermes/approve-address:
    get:
      tags:
        - get-approve-address
      summary: Get approve address
      description: Get approve address for the token transfer
      operationId: GetApproveAddress
      x-hyperledger-cacti:
        http:
          verbLowerCase: get
          path: /api/v1/@hyperledger/cactus-plugin-satp-hermes/approve-address
      parameters:
        - name: networkId
          description: The network of the DLT being interacted with.
          in: query
          schema:
            $ref: '#/components/schemas/NetworkId'
          required: true
        - name: tokenType
          description: The type of token being transferred.
          in: query
          schema:
            $ref: '#/components/schemas/TokenType'
          required: true
      responses:
        '200':
          description: Approve address for the token transfer
          content:
            application/json:
              schema:
                $ref: ./schemas.yml#/GetApproveAddressResponse
        '400':
          description: Bad request
        '404':
          description: Approve address not found
        '500':
          description: Internal server error
  /api/v1/@hyperledger/cactus-plugin-satp-hermes/add-counterparty-gateway:
    post:
      tags:
        - add-counterparty
      summary: Add counterparty
      description: Add a counterparty to the Gateway
      operationId: AddCounterparty
      x-hyperledger-cacti:
        http:
          verbLowerCase: post
          path: /api/v1/@hyperledger/cactus-plugin-satp-hermes/add-counterparty-gateway
      requestBody:
        description: Add counterparty request object.
        required: true
        content:
          application/json:
            schema:
              $ref: ./schemas.yml#/AddCounterpartyGatewayRequest
      responses:
        '200':  
          description: Counterparty added successfully
          content:
            application/json:
              schema:
                $ref: ./schemas.yml#/AddCounterpartyGatewayResponse
        '400':
          description: Bad request
        '404':
          description: Counterparty not found
        '500':
          description: Internal server error

  /api/v1/@hyperledger/cactus-plugin-satp-hermes/oracle/execute:
    post:
      summary: Execute data transfer task
      description: Execute a registered data transfer task from source to target blockchain
      operationId: ExecuteOracleTask
      tags:
      - oracle
      x-hyperledger-cacti:
        http:
          verbLowerCase: post
          path: /api/v1/@hyperledger/cactus-plugin-satp-hermes/oracle/execute
      requestBody:
        description: Execute request object.
        required: true
        content:
          application/json:
            schema:
              $ref: ./schemas.yml#/OracleExecuteRequest
      responses:
        '200':
          description: Response schema for executing a data transfer task.
          content:
            application/json:
              schema:
                $ref: ./schemas.yml#/OracleExecuteResponse
        '400':
          description: Bad request
        '404':
          description: Task not found
        '500':
          description: Internal server error

  /api/v1/@hyperledger/cactus-plugin-satp-hermes/oracle/register:
    post:
      summary: Register data transfer task
      description: Register data transfer from source to target blockchain
      operationId: RegisterOracleTask
      tags:
        - oracle
      x-hyperledger-cacti:
        http:
          verbLowerCase: post
          path: /api/v1/@hyperledger/cactus-plugin-satp-hermes/oracle/register
      requestBody:
        description: Register request object.
        required: true
        content:
          application/json:
            schema:
              $ref: ./schemas.yml#/OracleRegisterRequest
      responses:
        '200':
          description: Response schema for registering a data transfer task.
          content:
            application/json:
              schema:
                $ref: ./schemas.yml#/OracleRegisterResponse
        '400':
          description: Bad request
        '404':
          description: Transaction not found
        '500':
          description: Internal server error

  /api/v1/@hyperledger/cactus-plugin-satp-hermes/oracle/unregister:
    post:
      summary: Unregister data transfer task
      description: Unregister data transfer task from source to target blockchain
      operationId: UnregisterOracleTask
      tags:
        - oracle
      x-hyperledger-cacti:
        http:
          verbLowerCase: post
          path: /api/v1/@hyperledger/cactus-plugin-satp-hermes/oracle/unregister
      parameters:
        - name: taskID
          in: query
          schema:
            $ref: ./schemas.yml#/TaskID
          required: true
          description: Unique identifier for the task.
      responses:
        '200':
          description: Response schema for unregistering a data transfer task.
          content:
            application/json:
              schema:
                $ref: ./schemas.yml#/OracleUnregisterResponse
        '400':
          description: Bad request
        '404':
          description: Transaction not found
        '500':
          description: Internal server error
  /api/v1/@hyperledger/cactus-plugin-satp-hermes/oracle/status:
    get:
      summary: Get oracle task status
      description: Retrieve the status of an oracle task
      operationId: GetOracleTaskStatus
      tags:
        - oracle
      x-hyperledger-cacti:
        http:
          verbLowerCase: get
          path: /api/v1/@hyperledger/cactus-plugin-satp-hermes/oracle/status
      parameters:
        - name: taskID
          in: query
          schema:
            $ref: ./schemas.yml#/TaskID
          required: true
          description: Unique identifier for the task.
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                $ref: ./schemas.yml#/OracleStatusResponse
        '400':
          description: Bad request
        '404':
          description: Transaction not found
        '500':
          description: Internal server error

  /api/v1/@hyperledger/cactus-plugin-satp-hermes/webhook/inbound/decide:
    post:
      summary: Submit inbound webhook decision
      description: |-
        External approval controllers use this endpoint to submit decisions (approve/reject)
        for paused SATP transfers. When an adapter with an inbound webhook executes, the 
        gateway pauses and waits for an external decision via this endpoint.

        **Inbound Webhook Workflow:**
        1. SATP gateway reaches a stage/step with configured inbound adapter
        2. Gateway pauses execution and waits for external decision POST
        3. External controller evaluates business rules, compliance checks, or manual review
        4. Controller POSTs decision payload to this endpoint
        5. Gateway validates decision, logs justification, and resumes or aborts transfer

        **Decision Semantics:**
        - `continue: true` - Approve transfer continuation; gateway proceeds to next stage
        - `continue: false` - Reject transfer; gateway aborts and may trigger rollback
        - `reason` - Human-readable justification stored in audit logs

        **Timeout Handling:**
        Each inbound webhook declares a `timeoutMs` timeout. If no decision arrives
        within this window, the gateway treats it as a rejection and aborts the transfer.

        **Security Considerations:**
        - Inbound endpoints should use authentication (API keys, mTLS, JWT validation)
        - Decision payloads must include adapter ID to match the paused session state
        - All decisions are logged with timestamps for non-repudiation
      operationId: DecideInboundWebhook
      tags:
        - webhook
      x-hyperledger-cacti:
        http:
          verbLowerCase: post
          path: /api/v1/@hyperledger/cactus-plugin-satp-hermes/webhook/inbound/decide
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: ./schemas.yml#/InboundWebhookDecisionRequest
      responses:
        '200':
          description: Decision accepted and applied to the session
          content:
            application/json:
              schema:
                $ref: ./schemas.yml#/InboundWebhookDecisionResponse
        '400':
          description: Bad request - invalid decision payload
          content:
            application/json:
              schema:
                $ref: ./schemas.yml#/APIError
        '404':
          description: Session or adapter not found, or no pending decision
          content:
            application/json:
              schema:
                $ref: ./schemas.yml#/APIError
        '409':
          description: Decision conflict - session not in waiting state
          content:
            application/json:
              schema:
                $ref: ./schemas.yml#/APIError
        '500':
          description: Internal server error
          content:
            application/json:
              schema:
                $ref: ./schemas.yml#/APIError
components:
  schemas:
    $ref: ./schemas.yml
