version: 2.1
jobs:
  build:
    environment:
      CI_CONTAINERS_WAIT_TIME: 12
    machine:
      image: ubuntu-1604:201903-01
      resource_class: large
    steps:
      - checkout # check out source code to working directory
      - run:
          name: Setting up environment
          command: |
            sudo apt install -y util-linux
            source /opt/circleci/.nvm/nvm.sh
            nvm install 10.19.0
            nvm alias default 10.19.0
      - run:
          name: Run BIF CI Shell Script
          command: ./packages/core/tools/ci.sh

      # Upload test results for display in Test Summary:
      # https://circleci.com/docs/2.0/collect-test-data/
      - store_test_results:
          path: packages/core/examples/simple-asset-transfer/corda/logs/

      # Upload test results for display in Artifacts:
      # https://circleci.com/docs/2.0/artifacts/
      - store_artifacts:
          path: packages/core/examples/simple-asset-transfer/corda/logs/
          when: always

workflows:
  version: 2
  workflow:
    jobs:
      - build
